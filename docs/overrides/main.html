{% extends "base.html" %}

{% block extrahead %}
  {{ super() }}
  <script>
    (function () {
      try {
        var stored = localStorage.getItem('theme');
        var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        var theme = stored || (prefersDark ? 'dark' : 'light');
        var scheme = theme === 'dark' ? 'slate' : 'default';
        document.documentElement.setAttribute('data-md-color-scheme', scheme);

        document.addEventListener('DOMContentLoaded', function () {
          var paletteInput = document.querySelector(
            'input[data-md-color-scheme][value="' + scheme + '"]'
          );
          if (paletteInput && !paletteInput.checked) {
            paletteInput.checked = true;
          }

          var inputs = document.querySelectorAll('input[data-md-color-scheme]');
          inputs.forEach(function (input) {
            input.addEventListener('change', function () {
              var scheme = this.value;
              var theme = scheme === 'slate' ? 'dark' : 'light';
              localStorage.setItem('theme', theme);
            });
          });
        });

        window.addEventListener('storage', function (e) {
          if (e.key === 'theme') {
            var newTheme = e.newValue;
            var newScheme = newTheme === 'dark' ? 'slate' : 'default';
            document.documentElement.setAttribute('data-md-color-scheme', newScheme);
            var paletteInput = document.querySelector(
              'input[data-md-color-scheme][value="' + newScheme + '"]'
            );
            if (paletteInput && !paletteInput.checked) {
              paletteInput.checked = true;
            }
          }
        });
      } catch (e) {
        console.warn('Theme sync failed', e);
      }
    })();
  </script>
{% endblock %}
